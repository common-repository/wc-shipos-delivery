/*! wc-shipos-delivery 2.1.1 2024-10-02 5:13:32 PM */
!function(){"use strict";jQuery(document).ready(function(p){function t(){var a=p('[name="dvsfw_is_pickup"]').prop("checked"),t=p('[name="dvsfw_google_maps_api_key"]').closest("tr"),e=p('[name="dvsfw_pickup_point_display_preference"]').closest("tr"),r=p('[name="dvsfw_pickup_point_default_display"]').closest("tr");a?(t.show(),e.show(),r.show(),_(),p(document).on("change",'[name="dvsfw_pickup_point_display_preference"]',function(a){_()})):(t.hide(),e.hide(),r.hide())}function _(){var a=p('[name="dvsfw_pickup_point_display_preference"]').val(),t=p('[name="dvsfw_pickup_point_default_display"]').closest("tr");"both"===a?t.show():t.hide()}p(document).on("click",".sync_pickup",function(a){a.preventDefault();let t=p(this);p.ajax({url:matat_delivery.ajax_url,type:"POST",data:{action:"matat_sync_pickup_point"},success:function(a){t.text(a)},error:function(){}})}),p(".ship_status").click(function(a){a.preventDefault();var a=p(this).data("status"),t=p(this).data("license-key");p.ajax({url:matat_delivery.ajax_url,type:"POST",data:{action:"matat_get_order_details",dvsfw_order_id:a,matat_get_wpnonce:matat_delivery.matat_ajax_get_nonce,license_key:t},success:function(a){var a=JSON.parse(a),t=a.data.code;switch(1!=t&&2!=t&&(p(".matat_receiver_name").html(a.data.receiver),p(".matat_shipped_on").html(a.data.shipped_on)),t){case"1":matat_delivery.matat_status_1;break;case"2":matat_delivery.matat_status_2;break;case"3":matat_delivery.matat_status_3;break;case"4":matat_delivery.matat_status_4;break;case"5":matat_delivery.matat_status_5;break;case"7":matat_delivery.matat_status_7;break;case"8":matat_delivery.matat_status_8;break;case"9":matat_delivery.matat_status_9;break;case"12":matat_delivery.matat_status_12}p(".matat_delivery_status").html(a.data.text),p(".matat_receiver_name").html(a.data.receiver),p(".matat_shipped_on").html(a.data.shipped_on)}})}),p(document).on("click",".matat-open-button",function(t){t.preventDefault(),p(t.target).prop("disabled",!0),p("#matat_open_ship").append('<img class="matat_loader" src="'+matat_delivery.matat_ajax_loader+'" alt="shipos-loader">');var a=p("button.matat-open-button").attr("data-order");let e="1",r=(!0===p("#matat_urgent").is(":checked")&&(e="2"),"1"),_=(!0===p("#dvsfw_return").is(":checked")&&(r="2"),p("#matat_collect").val());isNaN(_)&&(_="NO");var s=p("#matat_motor").val(),o=p("#dvsfw_packages").val(),d=p("#dvsfw_exaction_date").val(),n=p("input[name=dvsfw_delivey_type]:checked").val();p(".matat_error_message").remove(),p.ajax({url:matat_delivery.ajax_url,type:"POST",data:{action:"matat_open_new_order",dvsfw_order_id:a,matat_urgent:e,dvsfw_return:r,matat_collect:_,matat_motor:s,dvsfw_packages:o,dvsfw_exaction_date:d,dvsfw_delivey_type:n,dvsfw_wpnonce:matat_delivery.matat_ajax_nonce},success:function(a){p(".matat_loader").hide(),p(".matat-powered-by").show(),a.success?location.reload():(p(".matat-button-container-open").append('<p class="matat_error_message">'+a.data+"</p>"),p(t.target).prop("disabled",!1))},error:function(){p(".matat_loader").hide(),p(".matat-powered-by").show(),p("#matat_open_ship").append('<p class="matat_error_message">'+matat_delivery.matat_err_message+"</p>"),p(t.target).prop("disabled",!1)}})}),p(document).on("click",".matat-open-button-new",function(t){t.preventDefault(),console.log(t.target),p(t.target).prop("disabled",!0),p("#matat_open_ship_new").append('<img class="matat_loader" src="'+matat_delivery.matat_ajax_loader+'" alt="shipos-loader">');var a=p("button.matat-open-button-new").attr("data-order");let e="1",r=(!0===p("#matat_urgent").is(":checked")&&(e="2"),"1"),_=(!0===p("#dvsfw_return_new").is(":checked")&&(r="2"),p("#matat_collect").val());isNaN(_)&&(_="NO");var s=p("#matat_motor").val(),o=p("#dvsfw_packages_new").val(),d=p("#dvsfw_license_new").val(),n=p("#dvsfw_exaction_date_new").val(),i=p("input[name=dvsfw_delivery_type_new]:checked").val();p(".matat_error_message").remove(),p.ajax({url:matat_delivery.ajax_url,type:"POST",data:{action:"matat_open_new_order",dvsfw_order_id:a,matat_urgent:e,dvsfw_return:r,matat_collect:_,matat_motor:s,dvsfw_packages:o,dvsfw_license:d,dvsfw_exaction_date:n,dvsfw_delivey_type:i,dvsfw_wpnonce:matat_delivery.matat_ajax_nonce},success:function(a){p(".matat_loader").hide(),p(".matat-powered-by-new").show(),a.success?location.reload():(p(".matat-button-container-open-new").append('<p class="matat_error_message">'+a.data+"</p>"),p(t.target).prop("disabled",!1))},error:function(){p(".matat_loader").hide(),p(".matat-powered-by-new").show(),p("#matat_open_ship_new").append('<p class="matat_error_message">'+matat_delivery.matat_err_message+"</p>"),p(t.target).prop("disabled",!1)}})}),p(document).on("click",".matat-cancel-ship",function(a){a.preventDefault();var t=p(this).closest(".matat-button-container"),a=(t.append('<img class="matat_loader" src="'+matat_delivery.matat_ajax_loader+'">'),p(this).data("shipping-id")),e=p(this).data("license-key"),r=p(this).data("order-id");p.ajax({url:matat_delivery.ajax_url,type:"POST",data:{action:"matat_change_order_status",dvsfw_ship_id:a,dvsfw_license_key:e,order_id:r,matat_change_wpnonce:matat_delivery.matat_ajax_change_nonce},success:function(a){p(".matat_loader").hide(),a.success?(location.reload(),t.closest(".matat-wrapper").append('<p class="matat_error_message">'+matat_delivery.matat_cancel_ship_ok+"</p>")):(a=a.data.message||matat_delivery.matat_err_message,t.closest(".matat-wrapper").append('<p class="matat_error_message">'+a+"</p>"))},error:function(){p(".matat_loader").hide(),t.append("<p>"+matat_delivery.matat_err_message+"</p>")}})}),p(document).on("click",".matat-reopen-ship",function(a){a.preventDefault(),p("#matat_ship_exists").hide(),p(".matat-powered-by").hide(),p(".matat-wrapper").append('<img class="matat_loader" src="'+matat_delivery.matat_ajax_loader+'">');a=p("#matat_ship_exists").attr("data-order");p.ajax({url:matat_delivery.ajax_url,type:"POST",data:{action:"dvsfw_reopen_ship",dvsfw_woo_order_id:a,dvsfw_reopen_wpnonce:matat_delivery.matat_ajax_reopen_nonce},success:function(a){location.reload()},error:function(){p(".matat_loader").hide(),p(".matat-powered-by").show(),p(".matat-wrapper").append("<p>"+matat_delivery.matat_err_message+"</p>")}})}),p("#matat_collect").change(function(){0==p(".matat_nis").length&&p("#matat_collect").after("<span class='matat_nis'>&#8362</span>")}),p(".matat_shop_order_delivery").click(function(a){a.preventDefault();var t=p(this).closest("button.matat_shop_order_delivery").attr("data-order"),e=p(".matat-table-deliv-not.order-"+t),r=p("button.matat_shop_order_delivery").attr("data-nonce"),a=(e.append('<img width="70px" class="matat_loader" src="'+matat_delivery.matat_ajax_loader+'">'),new Date),_=String(a.getDate()).padStart(2,"0"),s=String(a.getMonth()+1).padStart(2,"0"),s=a=a.getFullYear()+"-"+s+"-"+_;p.ajax({url:matat_delivery.ajax_url,type:"POST",data:{action:"matat_open_new_order",dvsfw_order_id:t,matat_urgent:"1",dvsfw_return:"1",matat_collect:"NO",matat_motor:"1",dvsfw_packages:"1",dvsfw_exaction_date:s,dvsfw_delivey_type:"1",dvsfw_wpnonce:matat_delivery.matat_ajax_nonce},success:function(a){console.log(a),p(".matat_loader").hide(),p(".matat-powered-by").show(),a.success?e.text("").html('<div class="matat-table-deliv-num">\n מספר שליחות: <span>'+a.data+'</span></div><a class="matat-button matat-print-button" target="_blank" data-order='+t+' href="post.php?matat_pdf=create&amp;matat_label_wpnonce='+r+"&amp;order_id="+t+'">הדפס תוית</a><br><span style="color: #FF0006;margin-left: 10px">'+a.company+"</span>"):e.append('<div style="color:red">'+a.data+"</div>")},error:function(){p(".matat_loader").hide(),p(".matat-powered-by").show(),p("#matat_open_ship").append("<p>"+matat_delivery.matat_err_message+"</p>")}})}),p(".matat_shop_order_delivery_new").click(function(a){a.preventDefault();var t=p(this).closest("button.matat_shop_order_delivery_new").attr("data-order"),a=p(this).closest("button.matat_shop_order_delivery_new").attr("data-license"),e=p(".matat-table-deliv-not-new.order-"+t),r=p("button.matat_shop_order_delivery_new").attr("data-nonce"),_=(e.append('<img width="70px" class="matat_loader" src="'+matat_delivery.matat_ajax_loader+'">'),new Date),s=String(_.getDate()).padStart(2,"0"),o=String(_.getMonth()+1).padStart(2,"0"),o=_=_.getFullYear()+"-"+o+"-"+s;p.ajax({url:matat_delivery.ajax_url,type:"POST",data:{action:"matat_open_new_order",dvsfw_order_id:t,matat_urgent:"1",dvsfw_return:"1",matat_collect:"NO",matat_motor:"1",dvsfw_packages:"1",dvsfw_license:a,dvsfw_exaction_date:o,dvsfw_delivey_type:"1",dvsfw_wpnonce:matat_delivery.matat_ajax_nonce},success:function(a){console.log(a),p(".matat_loader").hide(),p(".matat-powered-by").show(),a.success?e.text("").html('<div class="matat-table-deliv-num-new">\n מספר שליחות: <span>'+a.data+'</span></div><a class="matat-button matat-print-button-new" target="_blank" data-order='+t+' href="post.php?matat_pdf=create&amp;matat_label_wpnonce='+r+"&amp;order_id="+t+"&amp;ship_id="+a.shipping_id+'">הדפס תוית</a><br><span style="color: #FF0006;margin-left: 10px">'+a.company+"</span>"):e.append('<div style="color:red">'+a.data+"</div>")},error:function(){p(".matat_loader").hide(),p(".matat-powered-by").show(),p("#matat_open_ship").append("<p>"+matat_delivery.matat_err_message+"</p>")}})}),p(document).on("submit","#posts-filter",function(a){"cargo_bulk"==p("#bulk-action-selector-top").val()?p("#doaction").prop("disabled",!0):p("#doaction").prop("disabled",!1)}),p(document).on("change",'[name="dvsfw_automatic"]',function(a){"yes"==p(this).val()?p(".auto_delivery").removeClass("hidden"):p(".auto_delivery").addClass("hidden")}),t(),p(document).on("change",'[name="dvsfw_is_pickup"]',function(a){t()}),p(document).on("click","#doaction",function(a){if("undefined"!=typeof pagenow&&"edit-shop_order"===pagenow&&"shipos_bulk"===p("#bulk-action-selector-top").val()){a.preventDefault();a=p("form#posts-filter").serializeArray().filter(a=>"post[]"===a.name).map(a=>a.value);if(a.length){let t=new URLSearchParams;t.append("page","deliver-via-shipos"),a.forEach(a=>{t.append("dvsfw_select_ids[]",a)}),t.append("dvsfw_action","bulk_ship");a=matat_delivery.admin_url+"?"+t.toString();window.open(a,"_blank")}else alert("Please select some orders")}})})}();